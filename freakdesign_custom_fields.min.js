/*


      ############# 
    ##            *## 
   #        %      **#
  #        %%%    ***#
 #       %%F%D%%   ****#
#          %%%    *****#
#   ###     %     ###***# 
#  # ####       #### #**# 
#  #     #     #     #**# 
#   #####  # #  #####***# 
#         #   #  *******# 
 ### #           **# ### 
     # - - - - - - #                 
      | | | | | | |
	
     freakdesign.com               
      CUSTOM FIELDS

*/
(function(){if("undefined"!=typeof Shopify)if("undefined"!=typeof jQuery)if($("html.freakdesign_custom_fields").length)alert("Already loaded the tool?");else{var r=document,u=r.URL;r.documentElement.className+=" freakdesign_custom_fields";if(1<u.indexOf("myshopify.com/admin")){var a=function(){var r={no_fields:"No custom fields found",error_get_metafields:"Error getting product metafields",loaded:"Custom Field tool loaded"},t={debug:!1,author:"freakdesign",alpha:!1,omega:!1,wait:1E3,showHelp:!0,whiteLabel:!1,
lockToAlpha:!1,products:{},collections:{},linklists:{},pages:{},namespace:"custom_fields",namespace_new:"c_f",whitelist:[],key_articles:"[a]",key_collections:"[c]",key_customers:"[cu]",key_pages:"[g]",key_orders:"[o]",key_products:"[p]",key_variants:"[v]",marker_collection:"[_c]",marker_file:"[_f]",marker_int:"[_i]",marker_page:"[_g]",marker_product:"[_p]",marker_textarea:"[_t]",marker_linklist:"[_l]",help_file:"//freakdesign-us.s3.amazonaws.com/shopify/custom_fields/freakdesign-custom-fields-for-shopify-guide.pdf",
css:"//rawgithub.com/freakdesign/shopify-custom-fields/master/freakdesign_custom_fields.css"};return{data:function(a,c){if("undefined"===typeof c)return t[a];t[a]=c},translate:function(a){return r[a]},notice:function(a,c){c?Shopify.Flash.error(a):Shopify.Flash.notice(a)},escape_html:function(a){var c=document.createElement("div");c.appendChild(document.createTextNode(a));return c.innerHTML},unescape_html:function(a){if(void 0===a)return"";var c=document.createElement("div");c.innerHTML=a;return(a=
c.childNodes[0])?a.nodeValue:""},fd_modal:function(b,c,d,e){var f=$("#fdmodal");if(b){f.length&&f.remove();b=$('<div id="fdmodal" class="modalWindow"><div class="main content"><header></header></div></div>');d&&b.find("header").html("<h2>"+d+"</h2>");c&&(c=$("<div/>",{}).append(c),b.find("div.main.content").append(c));if(e)e=$('<a href="#" class="close-modal">X</a>'),e.on("click",function(){a.fd_modal(!1);return!1}),b.find("header").prepend(e).end().fadeIn();else b.fadeIn().on("click",function(){a.fd_modal(!1)});
$("body").append(b)}else f.off("click").remove()},load_css:function(){if(0===$("#css_custom_fields").length){var b=document.createElement("link");b.type="text/css";b.rel="stylesheet";b.id="css_custom_fields";b.href=a.data("css");document.getElementsByTagName("head")[0].appendChild(b)}},get_json:function(b,c,d){"undefined"===typeof c&&(c=!1);"undefined"===typeof b&&(b=!1);"undefined"===typeof d&&(d=!1);b&&$.ajax({type:"GET",url:b,dataType:"json",success:function(b){c&&c(b);d&&a.data(d,b)},error:function(){a.notice("Error getting JSON",
!0)}})},custom_fields_preload:function(b){$.ajax({type:"GET",url:"/admin/"+("undefined"!==typeof b?b:"collections")+".json?limit=250",dataType:"json",success:function(b){a.data("collections",b);a.setup_custom_fields(a.data("alpha"))},error:function(){a.notice("Failed to preload all data. Expect errors...",!0)}})},remove_brackets:function(a){a=a.replace(/\[([^\]]*)\]*/g,"");return a=a.charAt(0).toUpperCase()+a.slice(1).replace(/-/g," ").replace(/_/g," ")},save_custom_fields:function(b){if("object"===
typeof b){var c=b.t;if("undefined"===typeof b.type)var d=$("div.custom_fields_box.is-product input, div.custom_fields_box.is-product textarea"),e="product";else d=$(".custom_fields_box.is-variant input, .custom_fields_box.is-variant textarea"),e="variant";c.attr("style","color:rgba(0,0,0,0)").addClass("is-loading disabled");"undefined"===typeof b.callback&&(b.callback=!1);if("undefined"===typeof b.url)a.notice("Error, metafield url not set",!0),c.attr("style","").removeClass("is-loading disabled");
else if(d.length){var f=function(k,e){"undefined"===typeof k&&(k=0);if("undefined"===typeof e)a.notice("Type unknown",!0);else{var n=d.eq(k),g=n.attr("data-key"),s=n.val(),h="POST",m=n.attr("data-namespace"),p=n.attr("data-type"),q=!1,g={metafield:{namespace:m,key:g,value:s,value_type:p}};0===s.length&&n.attr("data-mid")&&n.attr("data-pid")?(h="DELETE",ajax_url="/admin/"+a.data("alpha")+"/"+n.attr("data-pid")+"/metafields/"+n.attr("data-mid")+".json",n.removeAttr("data-pid data-mid")):0===s.length?
q=!0:ajax_url=b.url;q?(k++,k<d.length?f(k,e):(c.attr("style","").removeClass("is-loading disabled"),a.notice("Custom fields saved"))):$.ajax({type:h,url:ajax_url,dataType:"json",data:g,success:function(b){k++;k<d.length?f(k,e):(c.attr("style","").removeClass("is-loading disabled"),a.notice("Custom fields saved"))},error:function(){a.notice("Error saving custom fields",!0);c.attr("style","").removeClass("is-loading disabled")}})}};f(0,e)}else a.notice("No fields to save",!0),c.attr("style","").removeClass("is-loading disabled")}},
setup_custom_fields:function(b){"undefined"===typeof b&&(b=!1);var c="/admin/"+a.data("alpha")+"/"+a.data("omega")+"/metafields.json",d=$('<div class="row section"><div id="cf-summary" class="span6 section-summary"><h1>Custom Fields</h1><p>Custom Fields are created by your developer and shown here when using the Custom Fields tool.</p></div><div class="span18 section-content"></div></div>'),e=$('header .header-right input[value="Save"]').eq(0),f=$("div.row.section").eq(0);a.data("showHelp")&&d.find(".section-summary").append('<p>Refer to the <a target="_blank" href="'+
a.data("help_file")+'">help file</a> for more info.</p>');if("customers"===a.data("alpha"))f=$("section.order-tags.ppt").eq(0),e=$('header .header-right a[data-route="routes.customers[customer].edit"]').eq(0);else if("orders"===a.data("alpha"))e=$("header .header-right ul").eq(1),f=$("section.box.box-details").eq(0);else if("pages"===a.data("alpha")||"articles"===a.data("alpha"))e=$('header .header-right button[type="submit"]').eq(0);f.length?f.after(d):a.notice("The HTML in this page is not as expected. I can not add the Custom Field panel",
!0);$("<a/>",{"class":"btn tooltip tooltip-bottom btn-primary",href:"#"}).html('<span class="tooltip-container"><span class="tooltip-label tooltip-right-align">Does NOT save the page</span></span>Save Custom Fields').on("click",function(b){b.preventDefault();b={t:$(this),callback:!1,url:c};a.save_custom_fields(b)});e.length&&"Save"===e.val()&&e.val("Save (without Custom Fields)");a.data("fields",[]);$.ajax({type:"GET",url:"/admin/metafields.json",dataType:"json",success:function(b){for(var e="",f=
"",g=0,s=b.metafields.length;g<s;g++){var h=b.metafields[g].namespace,m=!1;0<a.data("whitelist").length&&-1<$.inArray(h,a.data("whitelist"))&&(m=!0);var p=a.key_check(b.metafields[g].value+b.metafields[g].key);if(p.limit===a.data("alpha")||!1===p.limit)if(h===a.data("namespace")||h===a.data("namespace_new")||m){var q=b.metafields[g].key,l=a.data("fields");l.push(b.metafields[g].key);a.data("fields",l);q=a.remove_brackets(q);l='<div class="half">';l=1<b.metafields[g].value.length?l+('<label for="product-type"><span class="tooltip tooltip-bottom" style="display:inline-block;position:relative">'+
q+'<span class="tooltip-container"><span class="tooltip-label">'+b.metafields[g].namespace+"."+b.metafields[g].key+'</span></span></span><span class="note block">'+a.remove_brackets(b.metafields[g].value)+"</span></label>"):l+('<label for="product-type">'+q+"</label>");l="textarea"==p.field?l+('<textarea data-namespace="'+h+'" name="'+b.metafields[g].key+'" placeholder="'+a.remove_brackets(b.metafields[g].key)+'" data-key="'+b.metafields[g].key+'" data-type="'+b.metafields[g].value_type+'"></textarea>'):
l+('<input data-namespace="'+h+'" data-cffield="'+p.field+'" data-cftype="'+p.type+'" name="'+b.metafields[g].key+'" placeholder="'+a.remove_brackets(q)+'" value="" data-key="'+b.metafields[g].key+'" data-type="'+b.metafields[g].value_type+'">');l+="</div>";"undefined"!==typeof p.variant?f+=l:e+=l}}b=!0;e.length||(e='<div class="box warning">'+a.translate("no_fields")+"</div>",b=!1);d.find("div.section-content").append('<div class="custom_fields_box is-product clearfix fadein"><div class="content">'+
e+"</div></div>");a.data("variantPanel",f);b&&(d.find('input[data-cftype="collection"]').each(function(){var b=$(this);b.after(a.build_select(b.attr("name"),"collection"))}),d.find('input[data-cftype="linklist"]').each(function(){}),d.find('input[data-cftype="product"]').each(function(){}),$.ajax({type:"GET",url:c,dataType:"json",success:function(b){for(var c=0,d=b.metafields.length;c<d;c++)m=!1,0<a.data("whitelist").length&&-1<$.inArray(b.metafields[c].namespace,a.data("whitelist"))&&(m=!0),(b.metafields[c].namespace===
a.data("namespace")||b.metafields[c].namespace===a.data("namespace_new")||m)&&"global"!==b.metafields[c].namespace&&"description_tag"!==b.metafields[c].key&&$('input[data-key="'+b.metafields[c].key+'"],textarea[data-key="'+b.metafields[c].key+'"]').val(b.metafields[c].value).attr({"data-mid":b.metafields[c].id,"data-pid":a.data("omega")})},error:function(b){a.notice(a.translate("error_get_metafields"),!0)}}),e=$("<a />",{"class":"btn fadein btn-primary"}).on("click",function(b){b.preventDefault();
b={t:$(this),callback:!1,url:c};a.save_custom_fields(b)}).text("Save Custom Fields"),$("#cf-summary").append(e))},error:function(b){a.notice(a.translate("error_get_metafields"),!0)}});"products"===b&&(b=$("<a />",{"class":"btn btn-slim customfield_btn tooltip tooltip-bottom tooltip-right-align fadein",href:"#"}).html('<span class="tooltip-container"><span class="tooltip-label">Show Custom Fields</span></span>Custom Fields').on("click",function(b){b.preventDefault();var c=$(this);$("tr.custom_fields_box").find("input").each(function(){$(this).val("")}).end().remove();
b=$("<tr />",{"class":"custom_fields_box is-variant"});var c=c.closest("tr"),d=c.find("td.sku input.mock-edit-on-hover").eq(0).prop("id").split(/[- ]+/).pop(),e=$("<a />",{"class":"btn is-loading btn-primary","data-action":"save_custom_fields_variants"}).text("Save Variant Custom Fields").off("click").on("click",function(b){b.preventDefault();b={t:$(this),url:"/admin/variants/"+d+"/metafields.json",type:"variant"};a.save_custom_fields(b)}),f=$("<div />",{style:"clear: left;float: left;"});f.append(e);
var h=!0,m=$("<td />",{colspan:"6",style:"padding:1em;border-bottom:2px solid #000"});a.data("variantPanel").length?m.html(a.data("variantPanel")).append(f):(m.html('<div class="box warning">No custom fields found. For fields to appear here they must use the [v] marker.</div>'),h=!1);b.append(m);h?(b.find('input[data-cftype="collection"]').each(function(){var b=$(this);b.after(a.build_select(b.attr("name"),"collection"))}),c.after(b),$.ajax({type:"GET",url:"/admin/variants/"+d+"/metafields.json",
success:function(b){e.removeClass("is-loading");for(var c=$("tr.custom_fields_box.is-variant").eq(0),f=0,k=b.metafields.length;f<k;f++){var h=b.metafields[f];c.find('input[name="'+h.key+'"]').val(h.value).attr({"data-mid":h.id,"data-pid":a.data("omega"),"data-vid":d});c.find('textarea[name="'+h.key+'"]').val(h.value).attr({"data-mid":h.id,"data-pid":a.data("omega"),"data-vid":d})}}})):c.after(b)}),e=$("<li />"),e.append(b),$("table.variants tr.variant td:last-child ul.segmented").append(e))},build_select:function(b,
c){if(b){var d=a.data("collections"),e=$("<select />",{"data-ref":b,style:"width:50%"}).change(function(a){var c=$(this);a=c.val();c=c.parent().find('input[name="'+b+'"]').eq(0);a?c.val(a):c.val("")});if(d&&1<Object.keys(d.collections).length){for(var f='<option value="">Pick a collection</option>',k=0,r=Object.keys(d.collections).length;k<r;k++)f+='<option value="'+d.collections[k].handle+'">'+d.collections[k].title+"</option>";e.html(f);return e}a.notice("Error, invalid collection length",!0)}},
type_check:function(b,c){var d=!1;c&&(b+=c);0>b.indexOf(a.data("key_products"))&&0>b.indexOf(a.data("key_pages"))&&0>b.indexOf(a.data("key_collections"))&&0>b.indexOf(a.data("key_articles"))?d=!0:-1<b.indexOf(a.data("key_products"))&&"products"===a.data("alpha")?d=!0:-1<b.indexOf(a.data("key_articles"))&&"articles"===a.data("alpha")?d=!0:-1<b.indexOf(a.data("key_collections"))&&"custom_collections"===a.data("alpha")?d=!0:-1<b.indexOf(a.data("key_collections"))&&"smart_collections"===a.data("alpha")?
d=!0:-1<b.indexOf(a.data("key_collections"))&&"collections"===a.data("alpha")&&(d=!0);return d},key_check:function(b){var c={field:"text",type:!1,limit:!1};-1<b.indexOf(a.data("marker_collection"))?(c.field="select",c.type="collection"):-1<b.indexOf(a.data("marker_textarea"))&&(c.field="textarea",c.type="string");-1<b.indexOf(a.data("key_articles"))?c.limit="articles":-1<b.indexOf(a.data("key_collections"))?(c.limit="custom_collections","smart_collections"===a.data("alpha")&&(c.limit="smart_collections"),
"collections"===a.data("alpha")&&(c.limit="collections")):-1<b.indexOf(a.data("key_customers"))?c.limit="customers":-1<b.indexOf(a.data("key_pages"))?c.limit="pages":-1<b.indexOf(a.data("key_orders"))?c.limit="orders":-1<b.indexOf(a.data("key_variants"))?(c.limit="products",c.variant=!0):-1<b.indexOf(a.data("key_products"))&&(c.limit="products");return c},load_ui:function(){if(0===$("#freakdesign_main_button").length){var b=$("<a>",{id:"freakdesign_main_button","class":"fadein"}).text("Custom Fields ON").on("click",
function(b){b.preventDefault();a.data("whiteLabel")||a.fd_modal(!0,'<p><img src="//freakdesign-us.s3.amazonaws.com/shopify/custom_fields/i/modal_header.png" /></p><p>Custom Fields is "honor-ware", which means that we trust each other to be nice. As the developer of it, I\'m committed to keeping the tool something that\'s actually useful. By releasing new features and correcting possible bugs on a constant basis I can do just that, but I need your support. If you use it and intend to keep it, please sponsor its development by making a small <a target="_blank" href="http://shopify.freakdesign.com.au/#donate2">contribution</a>.</p><p>A small <a href="'+
a.data("help_file")+'" target="_blank">help guide</a> is avalable in PDF format.</p><p>Developers should consider using <a target="_blank" href="http://shopify.freakdesign.com.au/#ShopifyFD">ShopifyFD</a> to create the metafields this tool requires.</p>',"Custom Fields by Freakdesign",!0)}),c=$("<li />",{});c.append(b);$("a.sidebar-link.dashboard").parent().before(c)}},init:function(){$("html").data("loaded",!0);$.ajax({type:"GET",url:"/admin/metafields.json",dataType:"json",error:function(){a.notice("Error reading shop metafields",
!0)},success:function(b){a.data("shop_metafields",b);for(var c=0,d=b.metafields.length;c<d;c++)if("whitelist"===b.metafields[c].key&&"custom_fields_config"===b.metafields[c].namespace){var e=b.metafields[c].value.replace(/\s/g,"").split(",");a.data("whitelist",e)}setInterval(function(){if(!$("#content").hasClass("loading")){a.load_ui();var b=document.URL.split("#")[0].split("?")[0].split("/"),b=b[b.length-2],c=document.URL.split("/").pop();b===a.data("alpha")&&c===a.data("omega")||"next"===c||"prev"===
c||(a.data("alpha",b),a.data("omega",c),"articles"!=a.data("alpha")||isNaN(a.data("omega"))?"pages"!=a.data("alpha")||isNaN(a.data("omega"))?"products"!=a.data("alpha")||isNaN(a.data("omega"))?"customers"!=a.data("alpha")||isNaN(a.data("omega"))?"orders"!=a.data("alpha")||isNaN(a.data("omega"))?"collections"!=a.data("alpha")||isNaN(a.data("omega"))?"smart_collections"!=a.data("alpha")||isNaN(a.data("omega"))?"custom_collections"!=a.data("alpha")||isNaN(a.data("omega"))||a.data("lockToAlpha")&&a.data("lockToAlpha")!==
a.data("alpha")||a.custom_fields_preload("collections"):a.data("lockToAlpha")&&a.data("lockToAlpha")!==a.data("alpha")||a.custom_fields_preload("collections"):a.data("lockToAlpha")&&a.data("lockToAlpha")!==a.data("alpha")||a.custom_fields_preload("collections"):a.data("lockToAlpha")&&a.data("lockToAlpha")!==a.data("alpha")||a.custom_fields_preload():a.data("lockToAlpha")&&a.data("lockToAlpha")!==a.data("alpha")||a.custom_fields_preload():a.data("lockToAlpha")&&a.data("lockToAlpha")!==a.data("alpha")||
a.custom_fields_preload():a.data("lockToAlpha")&&a.data("lockToAlpha")!==a.data("alpha")||a.custom_fields_preload():a.data("lockToAlpha")&&a.data("lockToAlpha")!==a.data("alpha")||a.custom_fields_preload())}},a.data("wait"));setInterval(function(){a.load_ui()},5E3);a.notice(a.translate("loaded"))}})}}}();a.load_css();a.init()}else alert("Not admin")}else alert("No jquery found!");else alert("Shopify javascript is not found. Are you in your admin?")})();