/*


      ############# 
    ##            *## 
   #        %      **#
  #        %%%    ***#
 #       %%F%D%%   ****#
#          %%%    *****#
#   ###     %     ###***# 
#  # ####       #### #**# 
#  #     #     #     #**# 
#   #####  # #  #####***# 
#         #   #  *******# 
 ### #           **# ### 
     # - - - - - - #                 
      | | | | | | |
	
     freakdesign.com               
      CUSTOM FIELDS

*/
(function(){if("undefined"!=typeof Shopify)if("undefined"!=typeof jQuery)if($("html.freakdesign_custom_fields").length)alert("Already loaded the tool?");else{var q=document,x=q.URL;q.documentElement.className+=" freakdesign_custom_fields";if(1<x.indexOf("myshopify.com/admin")){var a=function(){var q={no_fields:"No custom fields found",error_get_metafields:"Error getting product metafields",loaded:"Custom Field tool loaded"},u={debug:!1,alpha:!1,omega:!1,wait:1E3,showHelp:!0,whiteLabel:!1,lockToAlpha:!1,
settings:!1,products:{},collections:{},linklists:{},pages:{},namespace:"custom_fields",namespace_new:"c_f",whitelist:[],key_articles:"[a]",key_collections:"[c]",key_customers:"[cu]",key_pages:"[g]",key_orders:"[o]",key_products:"[p]",key_variants:"[v]",marker_collection:"[_c]",marker_file:"[_f]",marker_int:"[_i]",marker_page:"[_g]",marker_product:"[_p]",marker_textarea:"[_t]",marker_linklist:"[_l]",help_file:"//freakdesign-us.s3.amazonaws.com/shopify/custom_fields/freakdesign-custom-fields-for-shopify-guide.pdf",
css:"//freakdesign-us.s3.amazonaws.com/shopify/custom_fields/s/freakdesign_custom_fields.css"};return{data:function(a,c){if("undefined"===typeof c)return u[a];u[a]=c},translate:function(a){return q[a]},setting:function(a){return"undefined"!==typeof a?u.settings[a]:u.settings},notice:function(a,c){c?Shopify.Flash.error(a):Shopify.Flash.notice(a)},escape_html:function(a){var c=document.createElement("div");c.appendChild(document.createTextNode(a));return c.innerHTML},unescape_html:function(a){if(void 0===
a)return"";var c=document.createElement("div");c.innerHTML=a;return(a=c.childNodes[0])?a.nodeValue:""},fd_modal:function(b,c,d,e){var f=$("#fdmodal");if(b){f.length&&f.remove();b=$('<div id="fdmodal" class="modalWindow"><div class="main content"><header></header></div></div>');d&&b.find("header").html("<h2>"+d+"</h2>");c&&(c=$("<div/>",{}).append(c),b.find("div.main.content").append(c));if(e)e=$('<a href="#" class="close-modal">&times;</a>'),e.on("click",function(){a.fd_modal(!1);return!1}),b.find("header").prepend(e).end().fadeIn();
else b.fadeIn().on("click",function(){a.fd_modal(!1)});$("body").append(b)}else f.off("click").remove()},load_css:function(){if(0===$("#css_custom_fields").length){var b=document.createElement("link");b.type="text/css";b.rel="stylesheet";b.id="css_custom_fields";b.href=a.data("css");document.getElementsByTagName("head")[0].appendChild(b)}},get_json:function(b,c,d){"undefined"===typeof c&&(c=!1);"undefined"!==typeof b&&("undefined"===typeof d&&(d=!1),b&&$.ajax({type:"GET",url:b,dataType:"json",success:function(b){c&&
c(b);d&&a.data(d,b)},error:function(){a.notice("Error getting JSON",!0)}}))},custom_fields_preload:function(b){$.ajax({type:"GET",url:"/admin/"+("undefined"!==typeof b?b:"collections")+".json?limit=250",dataType:"json",success:function(b){a.data("collections",b);a.setup_custom_fields(a.data("alpha"))},error:function(){a.notice("Failed to preload required data",!0)}})},remove_brackets:function(a){a=a.replace(/\[([^\]]*)\]*/g,"");return a=a.charAt(0).toUpperCase()+a.slice(1).replace(/-/g," ").replace(/_/g,
" ")},save_custom_fields:function(b){if("object"===typeof b)if("undefined"===typeof b.url)a.notice("Error, metafield url not set",!0);else{if("undefined"===typeof b.type)var c=$("div.custom_fields_box.is-product input, div.custom_fields_box.is-product textarea"),d="product";else c=$(".custom_fields_box.is-variant input, .custom_fields_box.is-variant textarea"),d="variant";if(c.length){"undefined"===typeof b.callback&&(b.callback=!1);var e=b.t;e.attr("style","color:rgba(0,0,0,0)").addClass("is-loading disabled");
var f=function(h,d){"undefined"===typeof h&&(h=0);if("undefined"===typeof d)a.notice("Type unknown",!0);else{var k=c.eq(h),g=k.attr("data-key"),v=k.val(),w="POST",l=k.attr("data-namespace"),p=k.attr("data-type"),m=!1,g={metafield:{namespace:l,key:g,value:v,value_type:p}};0===v.length&&k.attr("data-mid")&&k.attr("data-pid")?(w="DELETE",ajax_url="/admin/"+a.data("alpha")+"/"+k.attr("data-pid")+"/metafields/"+k.attr("data-mid")+".json",k.removeAttr("data-pid data-mid")):0===v.length?m=!0:ajax_url=b.url;
m?(h++,h<c.length?f(h,d):(e.attr("style","").removeClass("is-loading disabled"),a.notice("Custom fields saved"))):$.ajax({type:w,url:ajax_url,dataType:"json",data:g,success:function(b){h++;h<c.length?f(h,d):(e.attr("style","").removeClass("is-loading disabled"),a.notice("Custom fields saved"))},error:function(){a.notice("Error saving custom fields",!0);e.attr("style","").removeClass("is-loading disabled")}})}};f(0,d)}else a.notice("No fields to save",!0)}},setup_custom_fields:function(b){"undefined"===
typeof b&&(b=!1);var c="/admin/"+a.data("alpha")+"/"+a.data("omega")+"/metafields.json";$('<div class="row section"><div id="cf-summary" class="span6 section-summary"><h1>Custom Fields</h1><p>Custom Fields are created by your developer and shown here when using the Custom Fields tool.</p></div><div class="span18 section-content"></div></div>');var d=$('<section class="next-card"><div class="next-card__section"><div><div style="position: relative;" class="box-header clearfix"><h2>Custom Fields</h2><span id="cf-summary" class="box-header-action custom-fields-future-buttons"></span></div><div><div class="overflow-visible custom-fields-content"><p style="margin-top: .5em;">Custom Fields are created by your developer and shown here when using the Custom Fields tool.</p><div class="next-card__section"></div></div></div></div></div></section>'),
e=$('header .header-right input[value="Save"]').eq(0),f=$("div.section.description").eq(0);custom_field_panel=$('<div class="section custom-fields"><div class="next-grid"><div class="next-grid__cell next-grid__cell--quarter"><div class="section-summary"><h1>Custom Fields</h1><p>Manage the custom fields that belong to '+b+'.</p></div></div><div class="next-grid__cell"><div class="next-card"><div class="section-content" id="collection-metafields"><div class="next-card__section"></div></div></div></div></div></div>');
a.data("showHelp")&&(custom_field_panel.find(".section-summary").append('<p>Refer to the <a target="_blank" href="'+a.data("help_file")+'">help file</a> for more info.</p>'),d.find(".custom-fields-content p").eq(0).after('<p>Refer to the <a target="_blank" href="'+a.data("help_file")+'">help file</a> for more info.</p>'));"customers"===a.data("alpha")?(f=$("#customer-notes").eq(0).parent(),custom_field_panel=d):"orders"===a.data("alpha")?(e=$("header .header-right ul").eq(1),f=$(".next-card").eq(1),
custom_field_panel=d):"pages"===a.data("alpha")||"articles"===a.data("alpha")?e=$('header .header-right button[type="submit"]').eq(0):"products"===a.data("alpha")&&(f=$("div.next-card:not(.next-card--announcement)").eq(0),custom_field_panel=d);f.length?(a.setting("hideProductCustomFields")||f.after(custom_field_panel),e.length&&"Save"===e.val()&&e.val("Save (without Custom Fields)"),a.data("fields",[]),$.ajax({type:"GET",url:"/admin/metafields.json?limit=250",dataType:"json",success:function(b){for(var d=
"",k="",g=0,e=b.metafields.length;g<e;g++){var f=b.metafields[g].namespace,l=!1;0<a.data("whitelist").length&&-1<$.inArray(f,a.data("whitelist"))&&(l=!0);var p=a.key_check(b.metafields[g].value+b.metafields[g].key);if(p.limit===a.data("alpha")||!1===p.limit)if(f===a.data("namespace")||f===a.data("namespace_new")||l){var m=b.metafields[g].key,n=a.data("fields");n.push(b.metafields[g].key);a.data("fields",n);m=a.remove_brackets(m);n='<div class="half">';n=1<b.metafields[g].value.length?n+('<label for="product-type"><span class="tooltip tooltip-bottom" style="display:inline-block;position:relative">'+
m+'<span class="tooltip-container"><span class="tooltip-label">'+b.metafields[g].namespace+"."+b.metafields[g].key+'</span></span></span><span class="note block">'+a.remove_brackets(b.metafields[g].value)+"</span></label>"):n+('<label for="product-type">'+m+"</label>");n="textarea"==p.field?n+('<textarea data-namespace="'+f+'" name="'+b.metafields[g].key+'" placeholder="'+a.remove_brackets(b.metafields[g].key)+'" data-key="'+b.metafields[g].key+'" data-type="'+b.metafields[g].value_type+'"></textarea>'):
n+('<input data-namespace="'+f+'" data-cffield="'+p.field+'" data-cftype="'+p.type+'" name="'+b.metafields[g].key+'" placeholder="'+a.remove_brackets(m)+'" value="" data-key="'+b.metafields[g].key+'" data-type="'+b.metafields[g].value_type+'">');n+="</div>";"undefined"!==typeof p.variant?k+=n:d+=n}}b=!0;d.length||(d='<div class="box warning">'+a.translate("no_fields")+"</div>",b=!1);custom_field_panel.find("div.next-card__section").eq(0).append('<div class="custom_fields_box is-product clearfix fadein"><div class="content">'+
d+"</div></div>");a.data("variantPanel",k);if(b){custom_field_panel.find('input[data-cftype="collection"]').each(function(){var b=$(this);b.after(a.build_select(b.attr("name"),"collection"))});custom_field_panel.find('input[data-cftype="linklist"]').each(function(){});custom_field_panel.find('input[data-cftype="product"]').each(function(){});if("undefined"!==a.setting("datalists"))for(m in d=a.setting("datalists"),d)if(k=$('input[data-key="'+m+'"]'),k.length&&"false"===k.attr("data-cftype")){b=$("<datalist />",
{id:"list-"+m});k.attr("list","list-"+m);var g=d[m],r;for(r in g)g.hasOwnProperty(r)&&(e=$("<option />",{value:g[r]}),b.append(e));k.after(b)}$.ajax({type:"GET",url:c+"?limit=250",dataType:"json",success:function(b){for(var c=0,d=b.metafields.length;c<d;c++)l=!1,0<a.data("whitelist").length&&-1<$.inArray(b.metafields[c].namespace,a.data("whitelist"))&&(l=!0),(b.metafields[c].namespace===a.data("namespace")||b.metafields[c].namespace===a.data("namespace_new")||l)&&"global"!==b.metafields[c].namespace&&
"description_tag"!==b.metafields[c].key&&$('input[data-key="'+b.metafields[c].key+'"],textarea[data-key="'+b.metafields[c].key+'"]').val(b.metafields[c].value).attr({"data-mid":b.metafields[c].id,"data-pid":a.data("omega")})},error:function(b){a.notice(a.translate("error_get_metafields"),!0)}});m=$("<a />",{"class":"btn fadein fd-cf-btn"}).on("click",function(b){b.preventDefault();b={t:$(this),callback:!1,url:c};a.save_custom_fields(b)}).text("Save Custom Fields");r=custom_field_panel.find("div.section-summary");
r.length?r.append(m):custom_field_panel.find("span.custom-fields-future-buttons").append(m)}},error:function(b){a.notice(a.translate("error_get_metafields"),!0)}})):a.notice("Custom Fields error : setup_custom_fields() : target html not found",!0);"products"===b&&(b=$("<a />",{"class":"btn btn-slim customfield_btn tooltip next-field--connected next-field--connected next-field--connected--no-flex tooltip-bottom tooltip-right-align fadein",href:"#"}).html('<span class="tooltip-container"><span class="tooltip-label">Show Custom Fields</span></span><svg style="vertical-align: top;margin-top: 7px;" xmlns="http://www.w3.org/2000/svg" version="1.1" x="0px" y="0px" width="12px" height="12px" viewBox="0 0 12 12" enable-background="new 0 0 12 12" xml:space="preserve"><polygon fill="#D81965" points="0,0 0,12 10,12 10,11 11,11 11,10 12,10 12,0 "/><path fill="#FFFFFF" d="M7 9v1h1V9H7zM8 11h1v-1H8V11zM9 10h1V9H9V10zM10 9h1V8h-1V9zM1 11h1v-1H1V11zM2 10h1V9H2V10zM3 9h1V8H3V9zM1 6h10V5H1V6zM1 4h10V3H1V4zM1 1v1h10V1H1zM4 11v-1H3v1H4zM1 8v1h1V8H1z"/></svg>').on("click",
function(b){b.preventDefault();var c=$(this);$("tr.custom_fields_box").find("input").each(function(){$(this).val("")}).end().remove();b=$("<tr />",{"class":"custom_fields_box is-variant"});var c=c.closest("tr"),d=c.find("td:last a:first").prop("href").split("/").pop(),g=$("<a />",{"class":"btn is-loading btn-primary","data-action":"save_custom_fields_variants"}).text("Save Variant Custom Fields").off("click").on("click",function(b){b.preventDefault();b={t:$(this),url:"/admin/variants/"+d+"/metafields.json",
type:"variant"};a.save_custom_fields(b)}),e=$("<div />",{style:"clear: left;float: left;"});e.append(g);var f=!0,l=$("<td />",{colspan:"100",style:"padding:1em;border-bottom:2px solid #000"});a.data("variantPanel").length?l.html(a.data("variantPanel")).append(e):(l.html('<div class="box warning">No custom fields found. For fields to appear here they must use the [v] marker.</div>'),f=!1);b.append(l);f?(b.find('input[data-cftype="collection"]').each(function(){var b=$(this);b.after(a.build_select(b.attr("name"),
"collection"))}),c.after(b),$.ajax({type:"GET",url:"/admin/variants/"+d+"/metafields.json",success:function(b){g.removeClass("is-loading");for(var c=$("tr.custom_fields_box.is-variant").eq(0),e=0,f=b.metafields.length;e<f;e++){var h=b.metafields[e];c.find('input[name="'+h.key+'"]').val(h.value).attr({"data-mid":h.id,"data-pid":a.data("omega"),"data-vid":d});c.find('textarea[name="'+h.key+'"]').val(h.value).attr({"data-mid":h.id,"data-pid":a.data("omega"),"data-vid":d})}if("undefined"!==a.setting("datalists")){b=
a.setting("datalists");for(var l in b)if(e=c.find('input[data-key="'+l+'"]'),1===e.length){if("false"===e.attr("data-cftype")){f=$("<datalist />",{id:"list-"+l});e.attr("list","list-"+l);var h=b[l],t;for(t in h)if(h.hasOwnProperty(t)){var q=$("<option />",{value:h[t]});f.append(q)}e.after(f)}}else 1<e.length&&a.notice("Unexpected 1 field, got "+e.length)}}})):c.after(b)}),$(".new-variants-table__row td:last-child a:last-child").after(b))},build_select:function(b,c){if(b){var d=a.data("collections"),
e=$("<select />",{"data-ref":b,style:"width:50%"}).change(function(a){var c=$(this);a=c.val();c=c.parent().find('input[name="'+b+'"]').eq(0);a?c.val(a):c.val("")});if(d&&1<Object.keys(d.collections).length){for(var f='<option value="">Pick a collection</option>',h=0,t=Object.keys(d.collections).length;h<t;h++)f+='<option value="'+d.collections[h].handle+'">'+d.collections[h].title+"</option>";e.html(f);return e}a.notice("Error, invalid collection length",!0)}},type_check:function(b,c){var d=!1;c&&
(b+=c);0>b.indexOf(a.data("key_products"))&&0>b.indexOf(a.data("key_pages"))&&0>b.indexOf(a.data("key_collections"))&&0>b.indexOf(a.data("key_articles"))?d=!0:-1<b.indexOf(a.data("key_products"))&&"products"===a.data("alpha")?d=!0:-1<b.indexOf(a.data("key_articles"))&&"articles"===a.data("alpha")?d=!0:-1<b.indexOf(a.data("key_collections"))&&"custom_collections"===a.data("alpha")?d=!0:-1<b.indexOf(a.data("key_collections"))&&"smart_collections"===a.data("alpha")?d=!0:-1<b.indexOf(a.data("key_collections"))&&
"collections"===a.data("alpha")&&(d=!0);return d},key_check:function(b){var c={field:"text",type:!1,limit:!1};-1<b.indexOf(a.data("marker_collection"))?(c.field="select",c.type="collection"):-1<b.indexOf(a.data("marker_textarea"))&&(c.field="textarea",c.type="string");-1<b.indexOf(a.data("key_articles"))?c.limit="articles":-1<b.indexOf(a.data("key_collections"))?(c.limit="custom_collections","smart_collections"===a.data("alpha")&&(c.limit="smart_collections"),"collections"===a.data("alpha")&&(c.limit=
"collections")):-1<b.indexOf(a.data("key_customers"))?c.limit="customers":-1<b.indexOf(a.data("key_pages"))?c.limit="pages":-1<b.indexOf(a.data("key_orders"))?c.limit="orders":-1<b.indexOf(a.data("key_variants"))?(c.limit="products",c.variant=!0):-1<b.indexOf(a.data("key_products"))&&(c.limit="products");return c},load_ui:function(){if(0===$("#freakdesign_main_button").length){var b=$("<a>",{id:"freakdesign_main_button","class":"fadein"}).text("Custom Fields ON").on("click",function(b){b.preventDefault();
a.data("whiteLabel")||a.fd_modal(!0,'<p><img src="//freakdesign-us.s3.amazonaws.com/shopify/custom_fields/i/modal_header.png" /></p><p>Custom Fields is "honor-ware", which means that we trust each other to be nice. As the developer of it, I\'m committed to keeping the tool something that\'s actually useful. By releasing new features and correcting possible bugs on a constant basis I can do just that, but I need your support. If you use it and intend to keep it, please sponsor its development by making a small <a target="_blank" href="http://shopify.freakdesign.com.au/#donate2">contribution</a>.</p><p>A small <a href="'+
a.data("help_file")+'" target="_blank">help guide</a> is avalable in PDF format.</p><p>Developers should consider using <a target="_blank" href="http://shopify.freakdesign.com.au/#ShopifyFD">ShopifyFD</a> to create the metafields this tool requires.</p>',"Custom Fields by Freakdesign",!0)}),c=$("<li />",{});c.append(b);$("a.sidebar-link.dashboard").parent().before(c)}},init:function(){$("html").data("loaded",!0);$.ajax({type:"GET",url:"/admin/metafields.json?limit=250",dataType:"json",error:function(){a.notice("Error reading shop metafields",
!0)},success:function(b){a.data("shop_metafields",b);for(var c=0,d=b.metafields.length;c<d;c++)if("custom_fields_config"===b.metafields[c].namespace)if("whitelist"===b.metafields[c].key){var e=b.metafields[c].value.replace(/\s/g,"").split(",");a.data("whitelist",e)}else if("settings"===b.metafields[c].key)try{a.data("settings",JSON.parse(b.metafields[c].value))}catch(f){alert("SHOPIFY-FD: Error reading json settings")}setInterval(function(){if(!$("#content").hasClass("loading")){a.load_ui();var b=
document.URL.split("#")[0].split("?")[0].split("/"),b=b[b.length-2],c=document.URL.split("/").pop();b===a.data("alpha")&&c===a.data("omega")||"next"===c||"prev"===c||(a.data("alpha",b),a.data("omega",c),"articles"!=a.data("alpha")||isNaN(a.data("omega"))?"pages"!=a.data("alpha")||isNaN(a.data("omega"))?"products"!=a.data("alpha")||isNaN(a.data("omega"))?"customers"!=a.data("alpha")||isNaN(a.data("omega"))?"orders"!=a.data("alpha")||isNaN(a.data("omega"))?"collections"!=a.data("alpha")||isNaN(a.data("omega"))?
"smart_collections"!=a.data("alpha")||isNaN(a.data("omega"))?"custom_collections"!=a.data("alpha")||isNaN(a.data("omega"))||a.data("lockToAlpha")&&a.data("lockToAlpha")!==a.data("alpha")||a.custom_fields_preload("collections"):a.data("lockToAlpha")&&a.data("lockToAlpha")!==a.data("alpha")||a.custom_fields_preload("collections"):a.data("lockToAlpha")&&a.data("lockToAlpha")!==a.data("alpha")||a.custom_fields_preload("collections"):a.data("lockToAlpha")&&a.data("lockToAlpha")!==a.data("alpha")||a.custom_fields_preload():
a.data("lockToAlpha")&&a.data("lockToAlpha")!==a.data("alpha")||a.custom_fields_preload():a.data("lockToAlpha")&&a.data("lockToAlpha")!==a.data("alpha")||a.custom_fields_preload():a.data("lockToAlpha")&&a.data("lockToAlpha")!==a.data("alpha")||a.custom_fields_preload():a.data("lockToAlpha")&&a.data("lockToAlpha")!==a.data("alpha")||a.custom_fields_preload())}},a.data("wait"));setInterval(function(){a.load_ui()},5E3);a.notice(a.translate("loaded"))}})}}}();a.load_css();a.init()}else alert("Not admin")}else alert("No jquery found!");
else alert("Shopify javascript is not found. Are you in your admin?")})();